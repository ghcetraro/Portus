<VirtualHost *:443>
  ServerName ${REGISTRY_URL}
  ServerAlias ${REGISTRY_URL}
  SSLEngine on
  SSLCertificateFile /etc/apache2/ssl/linux.crt
  SSLCertificateKeyFile /etc/apache2/ssl/linux.key
#  SSLCertificateChainFile /etc/apache2/ssl/linux_ca.pem

  # Anti CRIME
  SSLCompression off

  # POODLE and other stuff
  SSLProtocol all -SSLv2 -SSLv3 -TLSv1

  # Secure cypher suites
  SSLCipherSuite EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH
  SSLHonorCipherOrder on

  RequestHeader set X-Forwarded-Proto "https"

  ProxyRequests     off
  ProxyPreserveHost on

  # no proxy for /error/ (Apache HTTPd errors messages)
  ProxyPass /error/ !

  ProxyRequests     off
  ProxyPreserveHost On
  ProxyPass        / http://${REGISTRY_IP}:5000/
  ProxyPassReverse / http://${REGISTRY_IP}:5000/

</VirtualHost>
